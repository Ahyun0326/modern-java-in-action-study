# 자바 8, 9, 10, 11 : 무슨 일이 일어나고 있는가?

자바 역사를 통틀어 가장 큰 변화가 자바 8에서 일어났다.

자바 8은 간결한 코드, 멀티코어 프로세서의 쉬운 활용이라는 두 가지 요구사항을 기반으로 한다.

자바 8에서 제공하는 새로운 기술
 - 스트림 API
 - 메서드에 코드를 전달하는 기법
 - 인터페이스의 디폴트 메서드

   
## 자바 8 설계의 밑바탕을 이루는 세 가지 프로그래밍 개념
1. 스트림처리
스트림이란 한 번에 한 개씩 만들어지는 연속적인 데이터 항목들의 모임이다.
스트림 API의 핵심은 우리가 하려는 작업을 고수준으로 추상화해서 일련의 스트림으로 만들어 처리할 수 있다는 것이다.
또한 스트림 파이프라인을 이용해서 입력 부분을 여러 CPU 코어에 쉽게 할당할 수 있다는 부가적인 이득도 얻을 수 있다.
스레드라는 복잡한 작업을 사용하지 않으면서도 공짜로 병렬성을 얻을 수 있다.

2. 동작 파라미터화로 메서드에 코드 전달하기
자바 8에서는 메서드를 다른 메서드의 인수로 넘겨주는 기능을 제공한다.
이와 같은 기능을 동적 파라미터화라고 부른다.
스트림 API는 연산의 동작을 파라미터화할 수 있는 코드를 전달한다는 사상에 기초한다.

3. 병렬성과 공유 가변 데이터
이 개념은 '병렬성을 공짜로 얻을 수 있다'라는 말에서 시작된다.
병렬성을 얻는 대신 코드의 동작 방식을 조금 바꿔야 한다.
다른 코드와 동시에 실행하더라도 안전하게 실행할 수 있는 코드를 만들려면 공유된 가변 데이터에 접근하지 않아야 한다.


## 자바 8에 추가된 새로운 개념
메서드 참조
```java
File[] hiddenFiles = new File(".").listFiles(File::isHidden);
```
이미 isHidden이라는 함수는 준비되어 있으므로 자바 8의 메서드 참조::를 이용해서 listFiles에 직접 전달할 수 있다.

자바 8에서는 람다를 포함하여 함수도 값으로 취급할 수 있다.
```java
(int x) -> x + 1
```
x라는 인수로 호출하면 x + 1을 반환하는 동작을 수행하도록 코드를 구현할 수 있다.

필터: 특정 항목을 선택해서 반환하는 동작
자바 8에서는 코드를 인수로 넘겨줄 수 있으므로 filter 메서드를 중복으로 구현할 필요가 없다.

메서드를 값으로 전달하는 것은 분명 유용한 기능이다.
하지만 한두 번만 사용할 메서드를 매번 정의하는 것은 귀찮은 일이다.
자바 8에서는 한 번만 사용할 메서드는 따로 정의를 구현하지 않고 람다를 이용해 코드를 구현할 수 있다.
```java
filterApples(inventory, (Apple a) -> GREEN.equals(a.getColor()) );
```

하지만 람다가 몇 줄 이상으로 길어진다면 메서드를 정의하고 메서드 참조를 활용하는 것이 바람직하다.
코드의 명확성이 우선시되어야 한다.


### 스트림
거의 모든 자바 애플리케이션은 컬렉션을 만들고 활용한다.
하지만 컬렉션으로 모든 문제가 해결되는 것은 아니다.
문제에 따라 중첩된 제어 흐름 문장이 많아서 코드를 한 번에 이해하기 어려운 경우가 생긴다.
스트림 API를 이용하면 문제를 해결할 수 있다.
외부 반복: 컬렉션에서 사용한 방식으로, for-each 루프를 이용해서 각 요소를 반복하면서 작업을 수행하는 방식
내부 반복: 스트림 API에서 사용한 방식으로, 라이브러리 내부에서 모든 데이터가 처리되는 방식

또 컬렉션을 사용했을 때 단일 CPU로 거대한 리스트를 처리하긴 힘들 것이다.
하지만 n개 코어를 활용해서 병렬로 작업을 수행하여 단일 CPU 컴퓨터에 비해 n배 빨리 작업을 처리할 수 있다.

이전 자바 버전에서 제공하는 스레드 API로 멀티스레딩 코드를 구현해서 병렬성을 이용하는 것은 쉽지 않다.
멀티스레딩 환경에서 각각의 스레드는 동시에 공유된 데이터레 접근하고, 데이터를 갱신할 수 있다.

자바 8은 스트림 API로 '컬렉션을 처리하면서 발생하는 모호함과 반복적인 코드 문제' 그리고 '멀티코어 활용 어려움'이라는 두 가지 문제를 모두 해결했다.

자주 반복되는 패턴으로 주어진 조건에 따라 데이터를 필터링하거나, 데이터를 추출하거나, 데이터를 그룹화하는 등의 기능이 있다.
또한 이러한 동작들을 쉽게 병렬화할 수 있다.
두 CPU를 가진 환경에서 리스트를 필터링할 때 한 CPU는 리스트의 앞부분을 처리하고, 다른 CPU는 리스트의 뒷부분을 처리하도록 요청할 수 있다.
이 과정을 포킹 단계라고 한다.


### 디폴트 메서드와 자바 모듈
요즘은 외부에서 만들어진 컴포넌트를 이용해 시스템을 구축하는 경향이 있다.
이와 관련해 지금까지 자바에서는 평범한 자바 패키지 집합을 포함하는 JAR 파일을 제공하는 것이 전부였다.
이러한 패키지의 인터페이스를 바꿔야 하는 상황에서는 인터페이스를 구현하는 모든 클래스의 구현을 바꿔야 했다.
자바 8에서는 인터페이스를 쉽게 바꿀 수 있도록 디폴트 메서드를 지원한다.

자바 8은 구현 클래스에서 구현하지 않아도 되는 메서드를 인터페이스에 추가할 수 있는 기능을 제공한다.
메서드 본문은 클래스 구현이 아니라 인터페이스의 일부로 포함된다.
디폴트 메서드를 이용하면 기존의 코드를 건드리지 않고도 원래의 인터페이스 설계를 자유롭게 확장할 수 있다.


### 함수형 프로그래밍에서 가져온 다른 유용한 아이디어
자바에 포함된 함수형 프로그래밍의 핵심적인 두 아이디어
- 메서드와 람다를 일급값으로 사용하는 것
- 가변 공유 상태가 없는 병렬 실행을 이용해서 효율적이고 안전하게 함수나 메서드를 호출할 수 있다는 것

자바 8에서는 NullPointer 예외를 피할 수 있도록 도와주는 Optional<T> 클래스를 제공한다.
Optional<T>는 값을 갖거나 갖지 않을 수 있는 컨테이너 객체다.
형식 시스템을 이용해서 어떤 변수에 값이 없을 때 어떻게 처리할지 명시할 수 있다.

구조적 패턴 매칭 기법도 있다.
자바 8은 패턴 매칭을 완벽하게 지원하지 않는다.
지금은 패턴 매칭이 switch를 확장한 것으로 데이터 형식 분류와 분석을 한 번에 수행할 수 있다는 정도로만 생각하자.
